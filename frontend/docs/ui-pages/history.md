# Страница истории транзакций

## Назначение
Отображение всех операций начисления и списания баллов.

## Путь
`/history`

## Доступ
- Только для авторизованных пользователей
- Доступна через нижнюю навигацию

---

## Структура страницы

### Шапка

**Заголовок:**
- "История баллов"

**Текущий баланс:**
- Карточка (компактная):
  - "Текущий баланс"
  - Число баллов (крупно): "250 ₽"

---

### Фильтры (опционально)

**Chips / Tabs:**
- "Все"
- "Начисления" (зеленые)
- "Списания" (красные)

---

### Основной контент

**Список транзакций:**
- Группировка по датам:
  - "Сегодня"
  - "Вчера"
  - "10 октября"
  - и т.д.

**Элемент транзакции:**

**Визуал:**
- Иконка:
  - ➕ зеленая (начисление)
  - ➖ красная (списание)
- Или иконка типа операции (опрос, респондент)

**Текст:**
- **Описание** (основное):
  - "Прохождение опроса: Опрос о питании"
  - "Ответ от респондента на: Опрос о спорте"
  - "Возврат за завершенный опрос"
  - "Бонус за регистрацию"
  
- **Время** (мелким, серым):
  - "14:32"
  - Или относительное: "5 мин назад"

**Сумма:**
- Справа, выровнено:
  - "+15" (зеленым)
  - "-10" (красным)
  - Крупный шрифт

**Баланс после (опционально):**
- Под суммой, мелким:
  - "Баланс: 250"

---

## Состояния

### 1. Загрузка
- Показываем skeleton элементы (5-10 штук)

### 2. Транзакции загружены
- Список отображается
- Группировка по датам
- Можно скроллить

### 3. Пустое состояние (нет транзакций)
- Иллюстрация
- Заголовок: "История пуста"
- Подзаголовок: "Здесь будет отображаться история начислений и списаний баллов"
- (Обычно не бывает, т.к. есть стартовый бонус)

### 4. Нет результатов фильтра
- Применен фильтр (только начисления / только списания)
- Нет транзакций этого типа
- Сообщение: "Нет транзакций данного типа"
- Кнопка: "Сбросить фильтр"

### 5. Подгрузка старых транзакций
- Бесконечная прокрутка
- Внизу списка loader при подгрузке

### 6. Ошибка загрузки
- "Не удалось загрузить историю"
- Кнопка: "Попробовать снова"

---

## Взаимодействия

### Клик на транзакцию (опционально)
- Открывается Bottom Sheet / Modal с деталями:
  - Полное описание
  - Дата и время (полное)
  - ID транзакции
  - Ссылка на связанный опрос (если есть)
  - Баланс до и после

### Фильтрация
- Нажатие на chip "Начисления" / "Списания"
- Список обновляется
- Показываем только транзакции выбранного типа

### Pull-to-refresh
- Свайп вниз для обновления
- Подгрузка новых транзакций

### Бесконечная прокрутка
- При достижении конца списка
- Автоматическая подгрузка следующей страницы

---

## Адаптация для Desktop

- Контент в центре (max-width: 800px)
- Более широкие карточки транзакций
- Можно показать больше информации сразу

---

## UI компоненты
- `BalanceCard` - карточка с балансом
- `TransactionItem` - элемент транзакции
- `FilterChips` - фильтры
- `EmptyState` - пустое состояние
- `SkeletonList` - skeleton loader
- `InfiniteScroll` - бесконечная прокрутка

---

## Технические детали

### API получение транзакций
```json
GET /api/transactions?
  type=all|credit|debit&
  page=1&
  limit=50
```

**Ответ:**
```json
{
  "transactions": [
    {
      "id": 123,
      "type": "credit",
      "amount": 15,
      "description": "Прохождение опроса: Опрос о питании",
      "survey_id": 10,
      "survey_title": "Опрос о питании",
      "created_at": "2025-10-20T14:32:00Z",
      "balance_after": 265
    },
    {
      "id": 122,
      "type": "debit",
      "amount": -10,
      "description": "Ответ от респондента на: Опрос о спорте",
      "survey_id": 5,
      "survey_title": "Опрос о спорте",
      "created_at": "2025-10-20T12:15:00Z",
      "balance_after": 250
    }
  ],
  "total": 50,
  "page": 1,
  "pages": 5,
  "current_balance": 265
}
```

---

## Группировка по датам

**Логика на клиенте:**
```javascript
const groupByDate = (transactions) => {
  const today = new Date()
  const yesterday = new Date(today)
  yesterday.setDate(yesterday.getDate() - 1)
  
  return transactions.reduce((groups, transaction) => {
    const date = new Date(transaction.created_at)
    let label
    
    if (isSameDay(date, today)) label = "Сегодня"
    else if (isSameDay(date, yesterday)) label = "Вчера"
    else label = formatDate(date, "d MMMM")
    
    if (!groups[label]) groups[label] = []
    groups[label].push(transaction)
    return groups
  }, {})
}
```

---

## Форматирование времени

**Относительное время** (для "Сегодня" и "Вчера"):
- "5 мин назад"
- "2 часа назад"
- "Вчера в 14:32"

**Абсолютное** (для старых):
- "10 октября, 14:32"

---

## Типы транзакций

**Начисления (credit):**
- Прохождение чужого опроса
- Бонус за регистрацию
- Возврат за завершенный опрос (неиспользованные баллы)
- Возврат за удаленный опрос

**Списания (debit):**
- Оплата ответа респондента
- Создание опроса (предоплата)

---

## Performance

**Оптимизации:**
- Виртуализация длинного списка (опционально)
- Пагинация / бесконечная прокрутка
- Кэширование в SWR (30 сек)

---

## Примечания
- История максимально простая
- Фокус на читаемости
- Четкое разделение начислений и списаний (цвета)
- Группировка по датам улучшает восприятие
- Можно быстро найти конкретную транзакцию
