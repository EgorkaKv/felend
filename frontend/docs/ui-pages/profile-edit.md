# Страница редактирования профиля

## Назначение
Редактирование имени, демографических данных, аватарки пользователя.

## Путь
`/profile/edit`

## Доступ
- Только для авторизованных пользователей
- Доступ из профиля

---

## Структура страницы

### Шапка
- Кнопка "Назад" (←) → `/profile`
- Заголовок: "Редактировать профиль"
- Кнопка "Сохранить" (справа)
  - Активна только если есть изменения
  - На мобильных: иконка ✓
  - На desktop: текст "Сохранить"

---

### Основной контент (Форма)

#### 1. Аватарка
- Большая аватарка по центру
- Кнопка "Изменить фото" под аватаркой
- При нажатии → выбор файла или модал с опциями

---

#### 2. Основная информация

**Имя:**
- Label: "Имя"
- Input:
  - Placeholder: "Как вас зовут?"
  - Max length: 100
  - Опционально

**Email:** (только отображение, не редактируется)
- Label: "Email"
- Текст: {user_email}
- Hint: "Для изменения email перейдите в Настройки"

---

#### 3. Демографические данные

**Заголовок секции:**
- "Демографические данные"
- Подзаголовок: "Эти данные помогут находить подходящие опросы"
- Все поля опциональны

**Возраст:**
- Label: "Возраст"
- Number input:
  - Min: 0
  - Max: 120
  - Placeholder: "Например, 22"

**Пол:**
- Label: "Пол"
- Radio group или Select:
  - Не указан
  - Мужской
  - Женский
  - Другой

**Занятость:**
- Label: "Занятость"
- Select:
  - Не указана
  - Студент
  - Работающий
  - Безработный
  - Пенсионер
  - Фрилансер

**Доход (в месяц):**
- Label: "Доход"
- Select:
  - Не указан
  - < 20,000 ₽
  - 20,000 - 50,000 ₽
  - 50,000 - 100,000 ₽
  - 100,000 - 200,000 ₽
  - > 200,000 ₽

**Семейное положение:**
- Label: "Семейное положение"
- Select:
  - Не указано
  - Холост / Не замужем
  - Женат / Замужем
  - В отношениях
  - Разведен(а)
  - Вдовец / Вдова

**Специальность работы:**
- Label: "Специальность"
- Text input:
  - Placeholder: "Например, маркетолог"
  - Max length: 100
  - Опционально

**Локация:**
- Label: "Город / Регион"
- Text input или Select:
  - Placeholder: "Например, Москва"
  - Max length: 100
  - Опционально
  - (В будущем можно добавить автозаполнение)

---

### Кнопки (внизу или в шапке)

- Кнопка "Сохранить" (primary)
  - Disabled если нет изменений
  - Показывает loader при сохранении

---

## Состояния

### 1. Загрузка данных
- Показываем skeleton формы
- Все поля disabled

### 2. Данные загружены
- Поля заполнены текущими значениями
- Можно редактировать
- Кнопка "Сохранить" disabled (нет изменений)

### 3. Редактирование
- Пользователь меняет значения
- Кнопка "Сохранить" становится активной
- Отслеживаем изменения (dirty state)

### 4. Сохранение (Loading)
- Кнопка показывает loader
- Текст: "Сохранение..."
- Форма disabled

### 5. Успех
- Snackbar: "Профиль обновлен"
- Данные сохранены
- Кнопка "Сохранить" снова disabled
- (Не редиректим, остаемся на странице)

### 6. Ошибка
- Snackbar: "Не удалось сохранить. Попробуйте снова"
- Форма снова активна
- Кнопка "Сохранить" активна

---

## Валидация

**Имя:**
- Опционально
- Max 100 символов

**Возраст:**
- Целое число 0-120
- Опционально

**Остальные поля:**
- Опциональны
- Только выбор из предложенных вариантов (Select)

---

## Взаимодействия

### Изменение аватарки
1. Нажатие "Изменить фото"
2. Модал/Bottom Sheet:
   - "Выбрать из галереи"
   - "Сделать фото" (мобильные)
   - "Удалить фото"
   - "Отмена"
3. После выбора:
   - Превью новой аватарки
   - Crop инструмент (опционально)
   - Кнопка "Готово"
4. Аватарка обновляется локально
5. При нажатии "Сохранить" загружается на сервер

### Несохраненные изменения
- Если пользователь нажал "Назад" с несохраненными изменениями:
- Показываем confirmation:
  - "Есть несохраненные изменения"
  - "Сохранить изменения?"
  - Кнопки: "Не сохранять" | "Сохранить"

---

## Адаптация для Desktop

- Форма в центре (max-width: 600px)
- Две колонки для некоторых полей
- Кнопка "Сохранить" в футере формы

---

## UI компоненты
- `Avatar` - аватарка
- `TextField` - текстовые поля
- `NumberInput` - ввод возраста
- `Select` - выпадающие списки
- `RadioGroup` - для пола
- `Button` (Primary)
- `Snackbar` - уведомления
- `Dialog` - подтверждение выхода
- `ImageCropModal` - обрезка фото (опционально)

---

## Технические детали

### API получение данных профиля
```json
GET /api/profile
```

**Ответ:**
```json
{
  "id": 1,
  "name": "Иван Петров",
  "email": "ivan@example.com",
  "avatar_url": "https://...",
  "demographic_data": {
    "age": 22,
    "gender": "male",
    "employment": "student",
    "income": "20000-50000",
    "marital_status": "single",
    "occupation": "Маркетолог",
    "location": "Москва"
  }
}
```

### API обновление профиля
```json
PUT /api/profile
{
  "name": "Иван Петров",
  "demographic_data": {
    "age": 22,
    "gender": "male",
    "employment": "student",
    "income": "20000-50000",
    "marital_status": "single",
    "occupation": "Маркетолог",
    "location": "Москва"
  }
}
```

**Ответ (успех):**
```json
{
  "message": "Профиль обновлен",
  "user": { /* обновленные данные */ }
}
```

### API загрузка аватарки
```json
POST /api/profile/avatar
Content-Type: multipart/form-data

{
  "avatar": File
}
```

---

## Отслеживание изменений

**Логика:**
```javascript
const [initialData, setInitialData] = useState(null)
const [formData, setFormData] = useState(null)

const hasChanges = !isEqual(initialData, formData)

// Кнопка "Сохранить" активна только если hasChanges === true
```

---

## Примечания
- Все демографические данные опциональны
- Но заполнение помогает находить подходящие опросы
- Можно мотивировать заполнение (подсказка/баннер)
- Email меняется только в настройках (требует подтверждения)
- Простая и быстрая форма
