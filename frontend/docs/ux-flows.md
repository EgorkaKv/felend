# UX Flows - Пользовательские сценарии Felend

## Flow 1: Первый запуск и регистрация

### Сценарий: Новый пользователь впервые открывает приложение

**Шаги:**

1. **Welcome Screen (Онбординг)**
   - Пользователь видит 2-3 экрана с объяснением концепции
   - Ключевые преимущества: бесплатный сбор ответов, система взаимопомощи, честный обмен
   - Кнопки: "Далее" и "Пропустить"
   - Последний экран: "Начать" или "Зарегистрироваться"

2. **Выбор метода регистрации**
   - Кнопка "Зарегистрироваться через Google" (OAuth)
   - Разделитель "или"
   - Форма: Email, Пароль, Подтверждение пароля
   - Кнопка "Зарегистрироваться"
   - Ссылка "Уже есть аккаунт? Войти"

3. **Подтверждение email** (если регистрация через email/пароль)
   - Показываем сообщение: "Мы отправили письмо на {email}"
   - Инструкция: "Проверьте почту и перейдите по ссылке для подтверждения"
   - Кнопка "Отправить письмо повторно"
   - Ссылка "Изменить email"

4. **Первый вход после регистрации**
   - Пользователь автоматически залогинен
   - Начальный баланс: **10 баллов**
   - Редирект на главную страницу (ленту опросов)
   - Показываем hint/tooltip: "У вас 10 баллов! Пройдите опросы, чтобы заработать больше"

**Альтернативный путь:**
- Пользователь выбирает "Войти через Google" → OAuth flow → автоматическая регистрация → вход

---

## Flow 2: Вход существующего пользователя

### Сценарий: Пользователь хочет войти в свой аккаунт

**Шаги:**

1. **Страница входа**
   - Кнопка "Войти через Google"
   - Разделитель "или"
   - Форма: Email, Пароль
   - Чекбокс "Запомнить меня" (опционально)
   - Кнопка "Войти"
   - Ссылка "Забыли пароль?"
   - Ссылка "Нет аккаунта? Зарегистрироваться"

2. **Успешный вход**
   - Редирект на главную страницу (ленту)
   - Баланс виден в шапке/профиле

**Обработка ошибок:**
- Неверный email или пароль → показать ошибку под формой
- Email не подтвержден → показать сообщение с кнопкой "Отправить письмо повторно"

---

## Flow 3: Прохождение опроса (Заработок баллов)

### Сценарий: Пользователь хочет заработать баллы, проходя чужие опросы

**Шаги:**

1. **Просмотр ленты опросов**
   - Пользователь видит карточки доступных опросов
   - На каждой карточке: название, награда, описание, категория, время прохождения/кол-во вопросов, кнопка "Пройти"
   - Карточки могут немного отличаться по длине
   - Фон карточки слегка окрашен в цветовую тему, которую указывает автор опроса
   - Поиск по названию вверху экрана
   - Кнопка фильтров (категория, награда, время)

2. **Выбор опроса**
   - Пользователь сразу видит всю информацию об опросе на карточке
   - Кнопка "Пройти" доступна прямо на карточке
   - Нажатие на кнопку "Пройти" → переход к прохождению опроса

3. **Проверка соответствия критериям** (если заданы автором)
   - **Подходит:** кнопка "Пройти" активна
   - **Не подходит:** кнопка неактивна + сообщение "Вы не подходите по критериям этого опроса"
   - **Не заполнен профиль:** предложение "Заполните профиль, чтобы проходить опросы с критериями"

4. **Нажатие "Пройти опрос"**
   - Открывается Google Forms в новой вкладке
   - В Felend показывается экран ожидания: 
     - "Заполните опрос в открывшейся вкладке"
     - "После завершения вернитесь сюда и нажмите 'Подтвердить прохождение'"
     - Кнопка "Открыть опрос снова" (если закрыл вкладку)
     - Кнопка "Подтвердить прохождение"

5. **Подтверждение прохождения**
   - Пользователь нажимает "Подтвердить прохождение"
   - Бекенд проверяет через Google Forms API наличие ответа с email пользователя
   
   **Успех:**
   - ✅ Показываем сообщение: "Прохождение подтверждено! +X баллов"
   - Анимация начисления баллов
   - Обновляем баланс
   - Опрос исчезает из ленты или помечается как "Пройден"
   
   **Email не найден:**
   - ❌ "Мы не нашли ваш email ({user_email}) в ответах на опрос"
   - Два варианта:
     - a) "Проверьте, правильно ли вы указали email в форме"
     - b) "Если вы использовали другой email, добавьте его в профиль"
   - Кнопки: "Попробовать снова" | "Добавить другой email"

6. **Добавление дополнительного email** (если нужно)
   - Пользователь вводит email, который использовал в форме
   - Отправляется письмо для подтверждения
   - После подтверждения можно снова нажать "Подтвердить прохождение"

**Альтернативные сценарии:**
- Пользователь может начать несколько опросов параллельно (каждый в своей вкладке)
- Пользователь может вернуться к прохождению позже (опрос остается в состоянии "в процессе")

---

## Flow 4: Создание собственного опроса

### Сценарий: Пользователь хочет собрать ответы на свой опрос

**Предусловие:** Пользователь уже создал Google Form самостоятельно

**Шаги:**

1. **Подключение Google аккаунта** (если еще не подключен)
   - Переход в Профиль → Google аккаунты
   - Кнопка "Подключить Google аккаунт"
   - OAuth flow
   - Аккаунт добавлен в список
   - Можно пометить как "Основной"

2. **Переход на страницу "Добавить опрос"**
   - Из нижней навигации нажать ➕
   - Или кнопка на странице "Мои опросы"

3. **Заполнение формы добавления опроса**
   
   **Обязательные поля:**
   - **Выбор Google аккаунта** (dropdown со списком подключенных аккаунтов)
   - **Ссылка на Google Form** (text input)
     - Placeholder: "https://forms.gle/..."
     - При вводе автоматическая валидация формата
   
   **Необязательные поля:**
   - **Категория** (dropdown, если категории уже реализованы)
   - **Критерии респондентов** (чекбоксы/селекты):
     - Возраст (от-до)
     - Пол (М/Ж/Другое)
     - Занятость (студент, работающий, безработный)
     - Доход (диапазоны)
     - Семейное положение
     - Специальность работы
     - Локация
     - Чекбокс: "Разрешить прохождение всем (игнорировать критерии)"
   - **Дополнительная награда в баллах** 
     - Показываем: "Минимальная награда: X баллов (рассчитано автоматически)"
     - Input: "Увеличить награду до: Y баллов" (Y >= X)
   - **Количество нужных ответов** (number input, default: не ограничено)
   - **Максимум ответов от одного пользователя** (number input, default: 1)

4. **Нажатие "Добавить опрос"**
   
   **Проверки на клиенте:**
   - Заполнены обязательные поля
   - Формат ссылки корректен
   - Выбран Google аккаунт
   
   **Проверки на сервере:**
   - Ссылка ведет на Google Form
   - У пользователя есть доступ к форме с выбранного аккаунта
   - В форме включен сбор email адресов
   - У пользователя достаточно баллов хотя бы для 1 респондента
   
   **Успех:**
   - ✅ "Опрос успешно добавлен!"
   - Списываются баллы (за первого респондента или за указанное количество)
   - Редирект на "Мои опросы"
   - Опрос появляется в ленте для других пользователей
   
   **Ошибки:**
   - ❌ "Нет доступа к форме" → "Убедитесь, что вы выбрали правильный Google аккаунт"
   - ❌ "В форме не включен сбор email" → "Включите сбор адресов в настройках Google Forms"
   - ❌ "Недостаточно баллов" → Показываем сколько нужно, сколько есть
     - Если баллов хватает на 1+ респондентов: warning "У вас недостаточно баллов для указанного количества респондентов (нужно X, у вас Y). Опрос будет создан, но сможет получить только Z ответов."
     - Если не хватает даже на 1: error "Недостаточно баллов для создания опроса. Заработайте баллы, проходя другие опросы."
     - Кнопка "Перейти к ленте опросов"

---

## Flow 5: Управление своими опросами

### Сценарий: Пользователь хочет управлять своими опросами и отслеживать прогресс

**Шаги:**

1. **Просмотр списка "Мои опросы"**
   - Переход через нижнюю навигацию
   - Список опросов с информацией:
     - Название
     - Статус (Активный / На паузе / Завершен / Удален)
     - Прогресс: "X / Y ответов" (прогресс-бар)
     - Дата создания
     - Потрачено баллов
   - Фильтры по статусу
   - Поиск по названию

2. **Действия с опросом** (кнопки/меню на каждой карточке)
   
   **Для активного опроса:**
   - 📊 "Посмотреть результаты" → открывает Google Forms с ответами
   - ⏸️ "Приостановить" → опрос перестает показываться в ленте
   - ⚙️ "Настройки" → изменение параметров (награда, критерии, кол-во)
   - 🗑️ "Удалить"
   
   **Для приостановленного опроса:**
   - ▶️ "Возобновить" → опрос снова в ленте (если есть баллы)
   - 📊 "Результаты"
   - ⚙️ "Настройки"
   - 🗑️ "Удалить"
   
   **Для завершенного опроса:**
   - 📊 "Результаты"
   - 📥 "Скачать данные" (опционально)

3. **Приостановка опроса**
   - Пользователь нажимает "Приостановить"
   - Confirmation dialog: "Вы уверены? Опрос перестанет показываться в ленте"
   - После подтверждения: статус → "На паузе"
   - Опрос исчезает из ленты

4. **Возобновление опроса**
   - Пользователь нажимает "Возобновить"
   - **Проверка баланса:**
     - Если баллов достаточно → опрос активируется
     - Если баллов мало → "Недостаточно баллов для возобновления. Заработайте еще X баллов"

5. **Автоматическая приостановка при нехватке баллов**
   - Когда баланс пользователя = 0, все его активные опросы → статус "На паузе"
   - Уведомление: "Ваши опросы приостановлены из-за нехватки баллов"
   - Кнопка "Заработать баллы" → переход к ленте

6. **Завершение опроса**
   - Опрос автоматически завершается когда:
     - Собрано нужное количество ответов
     - Пользователь вручную нажал "Завершить"
   - Статус → "Завершен"
   - Показываем статистику: "Собрано X ответов за Y дней, потрачено Z баллов"

7. **Удаление опроса**
   - Confirmation: "Вы уверены? Это действие нельзя отменить"
   - После удаления: статус → "Удален" (soft delete) или исчезает из списка

---

## Flow 6: Управление профилем и Google аккаунтами

### Сценарий A: Заполнение демографических данных

**Шаги:**

1. **Переход в профиль**
   - Нижняя навигация → Профиль
   - Видим: аватарка, имя, email, баланс баллов
   - Кнопка "Редактировать профиль"

2. **Редактирование профиля**
   - Аватарка (загрузка изображения, опционально)
   - Имя
   - Демографические данные:
     - Возраст (number или date picker)
     - Пол (select)
     - Занятость (select)
     - Доход (select: диапазоны)
     - Семейное положение (select)
     - Специальность работы (text или select)
     - Локация (text или геоселектор)
   - Все поля опциональные
   - Кнопка "Сохранить"

3. **Сохранение**
   - Успех: "Профиль обновлен"
   - Возврат на страницу профиля

---

### Сценарий B: Управление Google аккаунтами

**Шаги:**

1. **Просмотр подключенных аккаунтов**
   - В профиле: секция "Google аккаунты"
   - Список подключенных аккаунтов:
     - Аватарка Google
     - Email
     - Бейдж "Основной" (если это основной аккаунт)
     - Кнопки: "Сделать основным" | "Отключить"
   - Кнопка "+ Подключить новый аккаунт"

2. **Подключение нового аккаунта**
   - Нажать "+ Подключить новый аккаунт"
   - OAuth flow Google
   - После успешной авторизации: аккаунт добавлен в список
   - Уведомление: "Google аккаунт {email} подключен"

3. **Смена основного аккаунта**
   - Нажать "Сделать основным" на другом аккаунте
   - Аккаунт помечается как основной
   - При создании нового опроса этот аккаунт будет выбран по умолчанию

4. **Отключение аккаунта**
   - Нажать "Отключить"
   - Confirmation: "Вы уверены? Опросы, связанные с этим аккаунтом, могут перестать работать"
   - После подтверждения: аккаунт удален из списка
   - Если это был основной → автоматически выбирается другой основной (если есть)

---

### Сценарий C: Смена email и пароля

**Шаги:**

1. **Смена email**
   - В настройках профиля: "Изменить email"
   - Ввод нового email
   - Отправка письма для подтверждения
   - Переход по ссылке в письме → email изменен
   - Старый email больше не работает для входа

2. **Смена пароля**
   - В настройках: "Изменить пароль"
   - Поля: Текущий пароль, Новый пароль, Подтвердить пароль
   - Валидация: минимум 8 символов
   - Успех: "Пароль изменен"

---

## Flow 7: Просмотр истории транзакций

### Сценарий: Пользователь хочет увидеть за что начислялись/списывались баллы

**Шаги:**

1. **Переход в "История"**
   - Нижняя навигация → История
   - Список транзакций в обратном хронологическом порядке

2. **Отображение транзакции**
   - Каждая запись содержит:
     - Иконка типа операции (+ зеленая / - красная)
     - Описание: "Прохождение опроса '{название}'" или "Ответ от пользователя на '{название}'"
     - Сумма: "+X баллов" / "-X баллов"
     - Дата и время
     - Баланс после операции (опционально)

3. **Фильтрация** (опционально)
   - "Все" / "Начисления" / "Списания"

4. **Пагинация или бесконечная прокрутка**
   - Подгрузка старых транзакций при скролле

---

## Flow 8: Уведомления

### Сценарий: Пользователь получает важные уведомления

**Типы уведомлений:**

1. **"Опрос завершен"**
   - Когда собрано нужное количество ответов
   - Текст: "Поздравляем! Ваш опрос '{название}' собрал все ответы"
   - Действие: Переход к опросу для просмотра результатов

2. **"Закончились баллы"**
   - Когда баланс = 0 и есть активные опросы
   - Текст: "Баллы закончились. Ваши опросы приостановлены"
   - Действие: Переход к ленте опросов

3. **"Новый ответ"** (опционально, если не слишком спамит)
   - Когда получен новый ответ на опрос
   - Текст: "Получен новый ответ на опрос '{название}' (X / Y)"

**Отображение:**
- Бейдж с числом на иконке Профиля в нижней навигации
- В профиле: секция "Уведомления" с списком
- Каждое уведомление можно отметить как прочитанное или удалить

---

## Flow 9: Пустые состояния (Empty States)

### Сценарий A: В ленте нет доступных опросов

**Отображение:**
- Веселая иллюстрация (пустой список, милый персонаж)
- Заголовок: "Пока нет доступных опросов 🎈"
- Подзаголовок: "Возможно, все опросы уже пройдены или создайте свой первый опрос!"
- Кнопка: "Создать опрос"

---

### Сценарий B: У пользователя нет созданных опросов

**Отображение на странице "Мои опросы":**
- Иллюстрация
- Заголовок: "У вас еще нет опросов"
- Подзаголовок: "Создайте свой первый опрос и начните собирать ответы"
- Кнопка: "Создать опрос"

---

### Сценарий C: История транзакций пуста

**Отображение:**
- Заголовок: "История пуста"
- Подзаголовок: "Здесь будет отображаться история начислений и списаний баллов"

---

### Сценарий D: Нет уведомлений

**Отображение:**
- Заголовок: "Нет новых уведомлений"
- Подзаголовок: "Мы сообщим вам о важных событиях"

---

## Flow 10: Обработка ошибок и граничных случаев

### Сценарий A: Потеря интернет-соединения

**Поведение:**
- Показываем snackbar/toast: "Нет подключения к интернету"
- Попытка переподключения каждые X секунд
- Блокируем действия, требующие сети (отправка форм, загрузка данных)
- Кэшированные данные остаются видимыми

---

### Сценарий B: Ошибка сервера (500)

**Поведение:**
- Показываем friendly error: "Что-то пошло не так 😔"
- Подсказка: "Попробуйте обновить страницу или вернитесь позже"
- Кнопка "Обновить"

---

### Сценарий C: Токен авторизации истек

**Поведение:**
- Автоматический refresh token (если реализовано)
- Если refresh не удался → редирект на `/login`
- Сообщение: "Сессия истекла. Пожалуйста, войдите снова"

---

### Сценарий D: Пользователь пытается пройти уже пройденный опрос

**Поведение:**
- Кнопка "Пройти" неактивна
- Бейдж/метка "Пройдено"
- Подсказка: "Вы уже прошли этот опрос"
- Показываем дату прохождения

---

## Flow 11: Поиск и фильтрация

### Сценарий A: Поиск опросов в ленте

**Шаги:**

1. **Открытие поиска**
   - В шапке ленты: поле поиска
   - Placeholder: "Поиск опросов..."
   - При фокусе: клавиатура появляется

2. **Ввод запроса**
   - Поиск в реальном времени (debounce 300ms)
   - Поиск по названию опроса
   - Показываем результаты или "Ничего не найдено"

3. **Очистка поиска**
   - Иконка ❌ справа от поля
   - Возврат к полному списку

---

### Сценарий B: Фильтрация опросов

**Шаги:**

1. **Открытие фильтров**
   - Кнопка "Фильтры" в шапке ленты
   - Открывается bottom sheet / modal с фильтрами

2. **Доступные фильтры:**
   - **Категория** (чекбоксы, когда реализованы)
   - **Награда** (слайдер: от X до Y баллов)
   - **Время прохождения** (< 5 мин, 5-10 мин, > 10 мин)
   - **Только подходящие мне** (чекбокс - учитывать мои демографические данные)

3. **Применение фильтров**
   - Кнопка "Применить"
   - Лента обновляется
   - На кнопке "Фильтры" появляется бейдж с количеством активных фильтров

4. **Сброс фильтров**
   - Кнопка "Сбросить все"
   - Все фильтры сбрасываются

---

## Итого

Это основные пользовательские сценарии для MVP платформы Felend. Каждый flow покрывает конкретную user story и учитывает различные состояния, ошибки и граничные случаи.
